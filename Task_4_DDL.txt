
----------------------------Create Schema-------------------------
create USER RDB IDENTIFIED BY RDB#123;
GRANT CREATE SESSION TO RDB;
GRANT CREATE TABLE TO RDB;
GRANT CREATE VIEW TO RDB;
GRANT CREATE TRIGGER TO RDB;


create USER STG IDENTIFIED BY STG#123;
GRANT CREATE SESSION TO STG;
GRANT CREATE TABLE TO STG;
GRANT CREATE VIEW TO STG;
GRANT CREATE TRIGGER TO STG;
GRANT CREATE PROCEDURE TO STG;
GRANT CREATE SEQUENCE TO STG;

create USER PDB IDENTIFIED BY PDB#123;
GRANT CREATE SESSION TO PDB;
GRANT CREATE TABLE TO PDB;
GRANT CREATE VIEW TO PDB;
GRANT CREATE TRIGGER TO PDB;

create USER ADB IDENTIFIED BY ADB#123;
GRANT CREATE SESSION TO ADB;
GRANT CREATE TABLE TO ADB;
GRANT CREATE VIEW TO ADB;
GRANT CREATE TRIGGER TO ADB;

----------------------------Grant teablespaces for Schemas-------------------------
 alter user RDB quota unlimited on SAMMOUR;
 GRANT UNLIMITED TABLESPACE TO RDB;
 
 alter user STG quota unlimited on SAMMOUR;
 GRANT UNLIMITED TABLESPACE TO STG;

alter user PDB quota unlimited on SAMMOUR;
 GRANT UNLIMITED TABLESPACE TO PDB;
 
 alter user ADB quota unlimited on SAMMOUR;
 GRANT UNLIMITED TABLESPACE TO ADB;



----------------------------Create PDB Tables-------------------------




create table PDB.ORDERS(
Order_ID NVARCHAR2(200),
Order_Date DATE,
Ship_Date DATE,
SHIP_MODE NVARCHAR2(200),
Country NVARCHAR2(200),
City NVARCHAR2(200),
State NVARCHAR2(200),
Postal_Code NUMBER,
Region NVARCHAR2(200),
CONSTRAINT ORD_PK PRIMARY KEY (Order_ID)
);



CREATE TABLE PDB.CUSTOMERS(
Customer_ID NVARCHAR2(200),
Customer_Name NVARCHAR2(200),
SEGMENT NVARCHAR2(200),
CONSTRAINT CUSTOMER_PK PRIMARY KEY (Customer_ID)
);


CREATE TABLE PDB.PRODUCTS(
Product_ID NVARCHAR2(200),
Category NVARCHAR2(200),
Sub_Category NVARCHAR2(200),
Product_Name NVARCHAR2(200),
CONSTRAINT PRODUCT_PK PRIMARY KEY (Product_ID)
);


CREATE TABLE PDB.PRODUCTS_ORDERS(
PROD_ORD_ID NVARCHAR2(200),
Product_ID NVARCHAR2(200),
Order_ID NVARCHAR2(200),
Sales NUMBER,
Quantity integer, 
Discount NUMBER,
Profit NUMBER,
LOAD_DATE DATE,
CONSTRAINT PROD_ORD_PK PRIMARY KEY (PROD_ORD_ID),
CONSTRAINT PROD_ORD_FK FOREIGN KEY (Product_ID) REFERENCES PDB.PRODUCTS (Product_ID),
CONSTRAINT ORD_PROD_FK FOREIGN KEY (Order_ID) REFERENCES PDB.ORDERS (Order_ID)
);



CREATE TABLE PDB.PRODUCTS_CUSTOMERS(
Product_ID NVARCHAR2(200),
Customer_ID NVARCHAR2(200),
LOAD_DATE DATE,
CONSTRAINT PROD_CUST_PK PRIMARY KEY (Product_ID,Customer_ID , LOAD_DATE),
CONSTRAINT PROD_CUST_FK FOREIGN KEY (Product_ID) REFERENCES PDB.PRODUCTS (Product_ID),
CONSTRAINT CUST_PROD_FK FOREIGN KEY (Customer_ID) REFERENCES PDB.CUSTOMERS (Customer_ID)
);

----------------------------Create RDB Tables-------------------------

CREATE TABLE RDB.ORDERS_FILES (
ROW_ID VARCHAR2(200),
Order_ID VARCHAR2(200),
Order_Date VARCHAR2(200),
Ship_Date VARCHAR2(200),
Ship_Mode VARCHAR2(200),
Customer_ID VARCHAR2(200),
Customer_Name VARCHAR2(200),
Segment VARCHAR2(200),
Country VARCHAR2(200),
City VARCHAR2(200),
State VARCHAR2(200),
Postal_Code VARCHAR2(200),
Region VARCHAR2(200),
Product_ID VARCHAR2(200),
Category VARCHAR2(200),
Sub_Category VARCHAR2(200),
Product_Name CLOB,
Sales VARCHAR2(200),
Quantity VARCHAR2(200),
Discount VARCHAR2 (200) ,
Profit VARCHAR2(200),
file_date date
);


----------------------------Create STG Tables and Sequence-------------------------


CREATE SEQUENCE STG.PROD_ORD_SEQ
MINVALUE 1
MAXVALUE 100000
START WITH 1
INCREMENT BY 1;




create table STG.ORDERS (
Order_ID NVARCHAR2(200),
Order_Date DATE,
Ship_Date DATE,
Ship_MODE NVARCHAR2(200),
Country NVARCHAR2(200),
City NVARCHAR2(200),
State NVARCHAR2(200),
Postal_Code NUMBER,
Region NVARCHAR2(200)
);

CREATE TABLE STG.PRODUCTS_ORDERS(
PROD_ORD_ID NVARCHAR2(200),
Product_ID NVARCHAR2(200),
Order_ID NVARCHAR2(200),
Sales NUMBER,
Quantity integer, 
Discount NUMBER,
Profit NUMBER,
LOAD_DATE DATE
);

CREATE TABLE STG.PRODUCTS_ORDERS(
PROD_ORD_ID NVARCHAR2(200),
Product_ID NVARCHAR2(200),
Order_ID NVARCHAR2(200),
Sales NUMBER,
Quantity integer, 
Discount NUMBER,
Profit NUMBER,
LOAD_DATE DATE
);



CREATE TABLE STG.PRODUCTS_CUSTOMERS(
Product_ID NVARCHAR2(200),
Customer_ID NVARCHAR2(200),
LOAD_DATE DATE
);



CREATE TABLE STG.CUSTOMERS(
Customer_ID NVARCHAR2(200),
Customer_Name NVARCHAR2(200),
Segment NVARCHAR2(200)
);

CREATE TABLE STG.PRODUCTS(
Product_ID NVARCHAR2(200),
Category NVARCHAR2(200),
Sub_Category NVARCHAR2(200),
Product_Name NVARCHAR2(200)
);



----------------------------Create ADB Tables-------------------------

CREATE TABLE ADB.PRODUCTS (
Product_ID NVARCHAR2(200),
Category NVARCHAR2(200),
Sub_Category NVARCHAR2(200),
Product_Name NVARCHAR2(200), 
LOAD_DATE DATE
);


CREATE TABLE ADB.CUSTOMERS (
Customer_ID NVARCHAR2(200),
Customer_Name NVARCHAR2(200),
Segment NVARCHAR2(200), 
LOAD_DATE DATE
);

create table ADB.ORDERS (
Order_ID NVARCHAR2(200),
Order_Date DATE,
Ship_Date DATE,
Ship_MODE NVARCHAR2(200),
Country NVARCHAR2(200),
City VARCHAR2 (50), 
State VARCHAR2 (50), 
Postal_Code NUMBER,
Region NVARCHAR2(200),
LOAD_DATE DATE
);




----------------------------Grant Permisions-------------------------
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON RDB.ORDERS_FILES  TO  STG;


  GRANT  SELECT,INSERT, UPDATE,  DELETE ON ADB.ORDERS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON ADB.CUSTOMERS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON ADB.PRODUCTS  TO  STG;
  

  GRANT  SELECT,INSERT, UPDATE,  DELETE ON PDB.ORDERS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON PDB.CUSTOMERS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON PDB.PRODUCTS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON PDB.PRODUCTS_CUSTOMERS  TO  STG;
  GRANT  SELECT,INSERT, UPDATE,  DELETE ON PDB.PRODUCTS_ORDERS  TO  STG;